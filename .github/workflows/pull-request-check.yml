name: healthz-api-check

on: [pull_request]

jobs:
  pull-status-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: enviornment-setup
        run: |
          echo "Enviornment Setup"
          sudo apt install python3 python3-pip tree -y
          pip install --upgrade pip
          sudo apt install mysql-server
          pip install -r requirements.txt
      - name: healthz-check
        run: |
          python3 assignment2.py &
          sleep 3
          curl -vvvv http://localhost:8080/healthz
          sleep 5
          kill -9 `lsof -i:8080 -t`
          systemctl status mysql
          mysql -u root -p root
